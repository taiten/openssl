From 64c85430f95200b6b51fe9475bd5203f7c19daf1 Mon Sep 17 00:00:00 2001
From: Hugo Landau <hlandau@openssl.org>
Date: Thu, 21 Apr 2022 16:10:33 +0100
Subject: [PATCH] Fix bug in OPENSSL_LH_flush

Fixes #18139.

Reviewed-by: Richard Levitte <levitte@openssl.org>
Reviewed-by: Tomas Mraz <tomas@openssl.org>
(Merged from https://github.com/openssl/openssl/pull/18141)

(cherry picked from commit e5da68183410c06f7b350a0721bc2bd6057e438e)
---
 crypto/lhash/lhash.c | 2 ++
 1 file changed, 2 insertions(+)

--- a/crypto/lhash/lhash.c
+++ b/crypto/lhash/lhash.c
@@ -123,6 +123,8 @@ void OPENSSL_LH_flush(OPENSSL_LHASH *lh)
         }
         lh->b[i] = NULL;
     }
+
+    lh->num_items = 0;
 }
 
 void *OPENSSL_LH_insert(OPENSSL_LHASH *lh, void *data)
